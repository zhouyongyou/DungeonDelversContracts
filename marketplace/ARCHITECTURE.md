# DungeonDelvers Marketplace Architecture

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹ç¸½è¦½

### ç¨ç«‹éƒ¨ç½²æ¶æ§‹
```
DungeonDelvers ç”Ÿæ…‹ç³»çµ±
â”œâ”€â”€ æ ¸å¿ƒéŠæˆ²ç³»çµ±
â”‚   â”œâ”€â”€ éŠæˆ²åˆç´„ (Hero, Relic, Party, etc.)
â”‚   â”œâ”€â”€ ä¸»å­åœ– (éŠæˆ²æ•¸æ“šç´¢å¼•)
â”‚   â””â”€â”€ éŠæˆ²å‰ç«¯
â”‚
â””â”€â”€ å¸‚å ´ç³»çµ±ï¼ˆå®Œå…¨ç¨ç«‹ï¼‰
    â”œâ”€â”€ å¸‚å ´åˆç´„ (Marketplace, OfferSystem)
    â”œâ”€â”€ å¸‚å ´å­åœ– (äº¤æ˜“æ•¸æ“šç´¢å¼•)
    â””â”€â”€ å¸‚å ´å‰ç«¯æ¨¡å¡Š
```

## ğŸ“ æ–‡ä»¶ä½ç½®å°ç…§

### ä¸»éŠæˆ²ç³»çµ±
```
/Users/sotadic/Documents/DungeonDelversContracts/
â”œâ”€â”€ contracts/current/          # æ ¸å¿ƒéŠæˆ²åˆç´„
â”œâ”€â”€ scripts/active/             # ä¸»éƒ¨ç½²è…³æœ¬
â””â”€â”€ config/master-config.json   # ä¸»é…ç½®æ–‡ä»¶

/Users/sotadic/Documents/GitHub/DungeonDelvers/DDgraphql/dungeon-delvers/
â”œâ”€â”€ subgraph.yaml              # ä¸»å­åœ–é…ç½®ï¼ˆä¸å«å¸‚å ´ï¼‰
â””â”€â”€ schema.graphql             # ä¸» schemaï¼ˆä¸å«å¸‚å ´ï¼‰
```

### å¸‚å ´ç³»çµ±
```
/Users/sotadic/Documents/DungeonDelversContracts/
â”œâ”€â”€ contracts/current/marketplace/  # å¸‚å ´åˆç´„æºç¢¼
â”‚   â”œâ”€â”€ DungeonMarketplace.sol
â”‚   â””â”€â”€ OfferSystem.sol
â”‚
â””â”€â”€ marketplace/                    # ç¨ç«‹éƒ¨ç½²ç³»çµ±
    â”œâ”€â”€ deploy-standalone.js        # ç¨ç«‹éƒ¨ç½²è…³æœ¬
    â”œâ”€â”€ marketplace-config.json     # ç¨ç«‹é…ç½®
    â”œâ”€â”€ abis/                       # åˆç´„ ABI
    â””â”€â”€ subgraph/                   # ç¨ç«‹å­åœ–
        â”œâ”€â”€ subgraph.yaml
        â”œâ”€â”€ schema.graphql
        â””â”€â”€ src/
```

## ğŸ”„ éƒ¨ç½²æµç¨‹å°æ¯”

### é¸é … 1ï¼šå®Œå…¨ç¨ç«‹éƒ¨ç½²ï¼ˆæ¨è–¦ï¼‰
```bash
# 1. éƒ¨ç½²å¸‚å ´åˆç´„
npm run marketplace:deploy

# 2. éƒ¨ç½²å¸‚å ´å­åœ–
cd marketplace/subgraph
npm run update:addresses
npm run deploy:studio

# 3. å‰ç«¯é›†æˆ
import marketConfig from '@/marketplace-config.json';
```

### é¸é … 2ï¼šæ•´åˆåˆ° V25 éƒ¨ç½²ï¼ˆå¯é¸ï¼‰
```javascript
// åœ¨ v25-deploy-complete-sequential.js ä¸­
deployMarketplace: true
```

## ğŸ¯ è¨­è¨ˆæ±ºç­–

### ç‚ºä»€éº¼é¸æ“‡ç¨ç«‹æ¶æ§‹ï¼Ÿ

1. **é¢¨éšªéš”é›¢**
   - å¸‚å ´å•é¡Œä¸å½±éŸ¿éŠæˆ²é‹è¡Œ
   - åˆç´„æ¼æ´å½±éŸ¿ç¯„åœæœ‰é™
   - å¯ç¨ç«‹æš«åœå¸‚å ´åŠŸèƒ½

2. **é–‹ç™¼æ•ˆç‡**
   - ç¨ç«‹åœ˜éšŠå¯ä¸¦è¡Œé–‹ç™¼
   - éƒ¨ç½²é€±æœŸäº’ä¸å½±éŸ¿
   - æ¸¬è©¦å’Œèª¿è©¦æ›´ç°¡å–®

3. **å‡ç´šéˆæ´»æ€§**
   - å¯å–®ç¨å‡ç´šå¸‚å ´åŠŸèƒ½
   - ä¸éœ€è¦é‡æ–°éƒ¨ç½²æ•´å€‹ç³»çµ±
   - æ”¯æŒ A/B æ¸¬è©¦æ–°åŠŸèƒ½

4. **æ€§èƒ½å„ªåŒ–**
   - å­åœ–æŸ¥è©¢æ›´å¿«é€Ÿ
   - ç´¢å¼•æ•¸æ“šæ›´ç²¾ç°¡
   - å¯ç¨ç«‹æ“´å±•

## ğŸ“Š æ•¸æ“šæµæ¶æ§‹

```
ç”¨æˆ¶æ“ä½œ
   â†“
å‰ç«¯ç•Œé¢
   â†“
   â”œâ”€â†’ éŠæˆ²åˆç´„ â†â†’ ä¸»å­åœ– â†’ éŠæˆ²æ•¸æ“šæŸ¥è©¢
   â”‚
   â””â”€â†’ å¸‚å ´åˆç´„ â†â†’ å¸‚å ´å­åœ– â†’ å¸‚å ´æ•¸æ“šæŸ¥è©¢
```

## ğŸ” å®‰å…¨è€ƒé‡

### åˆç´„å±¤é¢
- ç¨ç«‹çš„æ¬Šé™ç®¡ç†
- ç¨ç«‹çš„ç·Šæ€¥æš«åœæ©Ÿåˆ¶
- æœ€å°åŒ–è·¨åˆç´„èª¿ç”¨

### é‹ç‡Ÿå±¤é¢
- ç¨ç«‹çš„ç›£æ§ç³»çµ±
- ç¨ç«‹çš„å¯©è¨ˆæµç¨‹
- ç¨ç«‹çš„å‡ç´šç­–ç•¥

## ğŸ“ˆ æ“´å±•æ€§

### æœªä¾†å¯èƒ½çš„æ“´å±•
1. **å¤šéˆéƒ¨ç½²**
   - å¸‚å ´å¯ç¨ç«‹éƒ¨ç½²åˆ°å…¶ä»–éˆ
   - ä¸å½±éŸ¿ä¸»éŠæˆ²é‚è¼¯

2. **åŠŸèƒ½æ¨¡å¡ŠåŒ–**
   - æ‹è³£ç³»çµ±
   - ç§Ÿè³ƒç³»çµ±
   - è·¨éˆæ©‹æ¥

3. **æ€§èƒ½å„ªåŒ–**
   - Layer 2 éƒ¨ç½²
   - ç‹€æ…‹é€šé“
   - æ‰¹é‡äº¤æ˜“

## ğŸ› ï¸ ç¶­è­·æŒ‡å—

### æ—¥å¸¸ç¶­è­·
- ä¸»éŠæˆ²å’Œå¸‚å ´åˆ†åˆ¥ç¶­è­·
- ç¨ç«‹çš„ç›£æ§ Dashboard
- ç¨ç«‹çš„æ—¥èªŒç³»çµ±

### ç·Šæ€¥éŸ¿æ‡‰
- å¯å–®ç¨æš«åœå¸‚å ´
- ä¸å½±éŸ¿éŠæˆ²æ ¸å¿ƒåŠŸèƒ½
- å¿«é€Ÿå›æ»¾æ©Ÿåˆ¶

## ğŸ“ æœ€ä½³å¯¦è¸

1. **é…ç½®ç®¡ç†**
   - ä¸»éŠæˆ²ï¼š`master-config.json`
   - å¸‚å ´ï¼š`marketplace-config.json`
   - ä¿æŒé…ç½®åˆ†é›¢

2. **ç‰ˆæœ¬æ§åˆ¶**
   - ç¨ç«‹çš„ç‰ˆæœ¬è™Ÿ
   - ç¨ç«‹çš„æ›´æ–°æ—¥èªŒ
   - æ¸…æ™°çš„ä¾è³´é—œä¿‚

3. **æ¸¬è©¦ç­–ç•¥**
   - ç¨ç«‹çš„æ¸¬è©¦å¥—ä»¶
   - ç¨ç«‹çš„æ¸¬è©¦ç’°å¢ƒ
   - æ•´åˆæ¸¬è©¦åˆ†é›¢

## ğŸš€ å¿«é€Ÿå‘½ä»¤åƒè€ƒ

### å¸‚å ´ç³»çµ±å‘½ä»¤
```bash
# éƒ¨ç½²
npm run marketplace:deploy
npm run marketplace:deploy:testnet

# é©—è­‰
npm run marketplace:verify

# å­åœ–
cd marketplace/subgraph
npm run update:addresses
npm run codegen
npm run build
npm run deploy:studio
```

### æ¸…ç†ä¸»å­åœ–
```bash
# ç§»é™¤ä¸»å­åœ–ä¸­çš„å¸‚å ´ç›¸é—œé…ç½®
node scripts/active/cleanup-main-subgraph.js
```

## ğŸ“š ç›¸é—œæ–‡æª”

- [å¸‚å ´åˆç´„ README](./README.md)
- [éƒ¨ç½²æŒ‡å—](./contracts/current/marketplace/README.md)
- [å­åœ–æ–‡æª”](./marketplace/subgraph/README.md)
- [å‰ç«¯é›†æˆæŒ‡å—](../src/hooks/useMarketplaceContract.ts)