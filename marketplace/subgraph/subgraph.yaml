# DungeonDelvers Marketplace Subgraph
# 獨立的市場子圖配置
specVersion: 0.0.4
schema:
  file: ./schema.graphql
dataSources:
  - kind: ethereum/contract
    name: DungeonMarketplace
    network: bsc
    source:
      address: '0x0000000000000000000000000000000000000000' # To be updated after deployment
      abi: DungeonMarketplace
      startBlock: 55714687 # To be updated after deployment
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - MarketListing
        - MarketTransaction
        - ListingPriceUpdate
        - MarketStats
      abis:
        - name: DungeonMarketplace
          file: ./abis/DungeonMarketplace.json
      eventHandlers:
        - event: ListingCreated(indexed uint256,indexed address,indexed uint8,address,uint256,uint256)
          handler: handleListingCreated
        - event: ListingSold(indexed uint256,indexed address,indexed address,uint256,uint256)
          handler: handleListingSold
        - event: ListingCancelled(indexed uint256,indexed address)
          handler: handleListingCancelled
        - event: ListingPriceUpdated(indexed uint256,uint256,uint256)
          handler: handleListingPriceUpdated
        - event: PlatformFeeUpdated(uint256,uint256)
          handler: handlePlatformFeeUpdated
        - event: FeeRecipientUpdated(address,address)
          handler: handleFeeRecipientUpdated
        - event: NFTContractApproved(indexed address,bool)
          handler: handleNFTContractApproved
      file: ./src/marketplace.ts
  - kind: ethereum/contract
    name: OfferSystem
    network: bsc
    source:
      address: '0x0000000000000000000000000000000000000000' # To be updated after deployment
      abi: OfferSystem
      startBlock: 55714687 # To be updated after deployment
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Offer
        - OfferTransaction
        - MarketStats
      abis:
        - name: OfferSystem
          file: ./abis/OfferSystem.json
      eventHandlers:
        - event: OfferCreated(indexed uint256,indexed address,indexed address,uint8,address,uint256,uint256,uint256,string)
          handler: handleOfferCreated
        - event: OfferAccepted(indexed uint256,indexed address,indexed address,uint256,uint256)
          handler: handleOfferAccepted
        - event: OfferDeclined(indexed uint256,indexed address)
          handler: handleOfferDeclined
        - event: OfferCancelled(indexed uint256,indexed address)
          handler: handleOfferCancelled
        - event: OfferExpired(indexed uint256)
          handler: handleOfferExpired
        - event: PlatformFeeUpdated(uint256,uint256)
          handler: handleOfferPlatformFeeUpdated
        - event: FeeRecipientUpdated(address,address)
          handler: handleOfferFeeRecipientUpdated
        - event: NFTContractApproved(indexed address,bool)
          handler: handleOfferNFTContractApproved
      file: ./src/offer-system.ts