# DungeonDelvers V18 部署記錄

## 部署資訊
- **版本**: V18 with V2Fixed Altar
- **網路**: BSC Mainnet
- **部署時間**: 2025-07-24 09:20:22 UTC
- **部署者**: 0x10925A7138649C7E1794CE646182eeb5BF8ba647

## 合約地址

| 合約名稱 | 地址 | 說明 |
|---------|------|------|
| TestUSD | `0xa095B8c9D9964F62A7dbA3f60AA91dB381A3e074` | 測試用 USD 穩定幣 |
| SoulShard | `0x97B2C2a9A11C7b6A020b4bAEaAd349865eaD0bcF` | 遊戲代幣 |
| Oracle | `0x1Cd2FBa6f4614383C32f4807f67f059eF4Dbfd0c` | 價格預言機 |
| DungeonCore | `0xDD970622bE2ac33163B1DCfB4b2045CeeD9Ab1a0` | 核心總機合約 |
| PlayerVault | `0xd0c6e73e877513e45491842e74Ac774ef735782D` | 玩家金庫 |
| PlayerProfile | `0xE5E85233082827941A9E9cb215bDB83407d7534b` | 玩家檔案 |
| VIPStaking | `0xe4B6C86748b49D91ac635A56a9DF25af963F8fdd` | VIP 質押系統 |
| DungeonStorage | `0x812C0433EeDD0bAf2023e9A4FB3dF946E5080D9A` | 地城資料存儲 |
| DungeonMaster | `0x5dCf67D1486D80Dfcd8E665D240863D58eb73ce0` | 地城主控 V8 |
| Hero | `0x6E4dF8F5413B42EC7b82D2Bc20254Db5A11DB374` | 英雄 NFT |
| Relic | `0x40e001D24aD6a28FC40870901DbF843D921fe56C` | 遺物 NFT |
| Party | `0xb26466A44f51CfFF8C13837dA8B2aD6BA82c62dF` | 隊伍 NFT V3 |
| AltarOfAscension | `0xCA4f59E6ccDEe6c8D0Ef239c2b8b007BFcd935E0` | 升級祭壇 V2Fixed |

## V18 新功能

### 1. V2Fixed 祭壇增強功能
- **冷卻時間機制**: 每次升級後需要等待冷卻時間才能再次升級
  - 1★→2★: 1 小時
  - 2★→3★: 2 小時
  - 3★→4★: 4 小時
  - 4★→5★: 8 小時
- **VIP 加成系統**: VIP 用戶可獲得成功率加成（最高 20%）
- **升級統計追蹤**: 記錄每個玩家的升級次數和成功次數
- **詳細事件記錄**: 發出更詳細的升級事件供子圖追蹤

### 2. 升級規則配置

| 稀有度 | 材料需求 | 手續費 (BNB) | 大成功率 | 成功率 | 部分失敗率 | 失敗率 | 冷卻時間 |
|--------|---------|--------------|----------|--------|------------|--------|----------|
| 1★→2★ | 5個 | 0.005 | 5% | 65% | 28% | 2% | 1小時 |
| 2★→3★ | 4個 | 0.01 | 4% | 51% | 35% | 10% | 2小時 |
| 3★→4★ | 3個 | 0.02 | 3% | 32% | 45% | 20% | 4小時 |
| 4★→5★ | 2個 | 0.05 | 2% | 18% | 50% | 30% | 8小時 |

### 3. 技術改進
- 修復了祭壇與 Hero/Relic 合約的接口相容性問題
- 使用正確的 `mintFromAltar()` 函數而非 `mintFromAltarWithId()`
- 改進了隨機數生成機制的安全性
- 優化了 gas 消耗

## 部署步驟執行摘要

1. ✅ 使用現有的 TestUSD 和 SoulShard 代幣
2. ✅ 部署所有核心合約
3. ✅ 設置合約間連接
4. ✅ 初始化遊戲參數
5. ✅ 配置 10 個地城
6. ✅ 設置 V2Fixed 祭壇升級規則
7. ✅ 保存部署記錄和地址

## 已知問題與處理

1. **PlayerVault 稅務函數缺失**: PlayerVault 合約不支援某些稅務設置函數，已跳過相關設置
2. **DungeonMaster 平台費用函數缺失**: DungeonMasterV8 不支援 `setPlatformFeeAmount`，已跳過
3. **Oracle Pool 地址**: 目前使用零地址作為 Pool，需要後續更新為實際的流動性池地址

## 後續待辦事項

1. **合約驗證**: 在 BSCScan 上驗證所有合約源碼
2. **子圖更新**: 更新 The Graph 子圖配置以追蹤 V2Fixed 祭壇事件
3. **前端配置**: 更新前端應用的合約地址和 ABI
4. **後端配置**: 更新後端服務的環境變數
5. **功能測試**: 完整測試所有功能，特別是新的祭壇功能
6. **VIP 用戶配置**: 設置初始 VIP 用戶列表和加成比例

## 安全建議

1. 在主網正式運營前進行完整的安全審計
2. 設置多簽錢包作為合約的 Owner
3. 監控異常交易和合約調用
4. 準備緊急暫停機制的應急預案

## 聯絡資訊

如有問題請聯繫開發團隊：
- 技術負責人: [聯絡資訊]
- 運營負責人: [聯絡資訊]

---
*此文件由 DungeonDelvers 開發團隊維護*
*最後更新: 2025-07-24*