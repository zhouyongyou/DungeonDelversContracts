# V25.0.3 部署檢查清單

## 📅 部署資訊
- **版本**: V25.0.3
- **日期**: 2025-08-20 22:00
- **網路**: BSC Mainnet
- **起始區塊**: 58266666
- **子圖版本**: v3.9.4
- **管理員錢包**: 0xEbCF4A36Ad1485A9737025e9d72186b604487274

## ⚠️ 重要提醒
- 原私鑰已洩露，使用新的安全私鑰
- VRF 訂閱使用獨立錢包管理
- 部署完成後立即同步配置

## 📋 部署前準備

### 1. 環境檢查
- [ ] 確認 `.env` 文件中的私鑰是安全的（非洩露的）
- [ ] 確認部署錢包有足夠的 BNB（至少 0.5 BNB）
- [ ] 確認 BSCScan API Key 已設置
- [ ] 確認 hardhat.config.js 配置正確

### 2. 合約準備
- [ ] 編譯所有合約: `npx hardhat compile`
- [ ] 確認 TSOUL.sol 和 TUSD1.sol 存在
- [ ] 確認所有合約編譯無錯誤

## 🚀 部署步驟

### Phase 1: 代幣部署
```bash
npx hardhat run scripts/deploy-v25-0-3.js --network bsc
```

1. [ ] TSOUL 代幣部署成功
2. [ ] TUSD1 代幣部署成功
3. [ ] **手動創建 Uniswap V3 池子**
   - Token A: TSOUL
   - Token B: TUSD1
   - Fee Tier: 0.3% (3000)
   - 初始價格: 根據需求設定

### Phase 2: 核心合約部署
4. [ ] DungeonStorage 部署成功
5. [ ] DungeonMaster 部署成功
6. [ ] Hero NFT 部署成功
7. [ ] Relic NFT 部署成功
8. [ ] AltarOfAscension 部署成功
9. [ ] Party NFT 部署成功

### Phase 3: 合約配置
10. [ ] DungeonMaster 連接 DungeonStorage
11. [ ] 所有合約地址保存到 `.env.v25.0.3`

## ✅ 部署後驗證

### 1. 合約驗證
```bash
npx hardhat run scripts/verify-v25-0-3.js --network bsc
```
- [ ] 所有合約在 BSCScan 上驗證成功

### 2. DungeonCore 更新（需要 owner 權限）
需要更新 DungeonCore 中的以下地址：
- [ ] setHero(新 Hero 地址)
- [ ] setRelic(新 Relic 地址)
- [ ] setParty(新 Party 地址)
- [ ] setDungeonMaster(新 DungeonMaster 地址)
- [ ] setDungeonStorage(新 DungeonStorage 地址)
- [ ] setAltarOfAscension(新 AltarOfAscension 地址)
- [ ] setSoulShard(新 TSOUL 地址)
- [ ] setUSD(新 TUSD1 地址)

### 3. VRF 配置
- [ ] 確認 VRF 訂閱 ID: 88422796721004450630713121079263696788635490871993157345476848872165866246915
- [ ] 確認 VRF Manager 已添加到訂閱
- [ ] 確認訂閱有足夠的 LINK

## 🔄 配置同步

### 1. 執行同步腳本
```bash
node scripts/sync-v25-0-3.js
```
- [ ] 前端配置更新成功
- [ ] 後端配置更新成功
- [ ] 子圖配置更新成功

### 2. 重啟服務
- [ ] 前端開發服務器重啟
- [ ] 後端服務器重啟

### 3. 子圖編譯和部署
```bash
cd /Users/sotadic/Documents/GitHub/DungeonDelvers/DDgraphql/dungeon-delvers
npm run codegen
npm run build
```
- [ ] 子圖編譯成功
- [ ] 子圖部署到 v3.9.4（手動）

## 🧪 功能測試

### 基礎功能
- [ ] Hero NFT 鑄造測試
- [ ] Relic NFT 鑄造測試
- [ ] Party 創建測試
- [ ] 地城探索測試
- [ ] 升星祭壇測試

### 整合測試
- [ ] 前端能正確顯示 NFT
- [ ] 子圖能正確索引事件
- [ ] 後端 API 正常響應

## 📊 部署後監控

- [ ] 監控合約交易
- [ ] 檢查 Gas 使用情況
- [ ] 監控錯誤日誌
- [ ] 設置告警系統

## 📝 文檔更新

- [ ] 更新 README 中的合約地址
- [ ] 更新部署記錄文件
- [ ] 通知團隊成員新地址
- [ ] 更新用戶文檔

## 🔐 安全檢查

- [ ] 確認私鑰已安全備份
- [ ] 確認 `.env` 文件未提交到 Git
- [ ] 確認所有權限設置正確
- [ ] 確認沒有暴露敏感信息

## 📞 緊急聯絡

如果部署過程中遇到問題：
1. 檢查錢包餘額
2. 檢查網路連接
3. 查看錯誤日誌
4. 回滾到上一個穩定版本

---

## 部署完成確認

- [ ] **所有檢查項目已完成**
- [ ] **系統運行正常**
- [ ] **文檔已更新**
- [ ] **團隊已通知**

部署人員簽名: _______________
部署時間: _______________