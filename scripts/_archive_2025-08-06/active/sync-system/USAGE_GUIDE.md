# ğŸ“– V25 åŒæ­¥ç³»çµ±ä½¿ç”¨æŒ‡å—

## ğŸš€ å¿«é€Ÿé–‹å§‹

### åŸºæœ¬ç”¨æ³•

```bash
# é€²å…¥åŒæ­¥ç³»çµ±ç›®éŒ„
cd /Users/sotadic/Documents/DungeonDelversContracts/scripts/active/sync-system

# åŸ·è¡Œå®Œæ•´åŒæ­¥ï¼ˆæŒ‡å®šå­åœ–ç‰ˆæœ¬ï¼‰
node index.js v3.6.1

# æˆ–è€…äº’å‹•å¼è¼¸å…¥ç‰ˆæœ¬
node index.js
# æç¤ºï¼šè«‹è¼¸å…¥å­åœ–ç‰ˆæœ¬ (å¦‚ v3.6.1) æˆ–æŒ‰ Enter ä½¿ç”¨é»˜èªç‰ˆæœ¬: v3.6.1
```

## ğŸ“‹ åŠŸèƒ½åˆ—è¡¨

### 1. å®Œæ•´åŒæ­¥ï¼ˆæœ€å¸¸ç”¨ï¼‰
å°‡æ‰€æœ‰é…ç½®åŒæ­¥åˆ°å‰ç«¯ã€å¾Œç«¯ã€å­åœ–é …ç›®ã€‚

```bash
node index.js v3.6.1
```

**åŒæ­¥å…§å®¹**ï¼š
- âœ… æ™ºèƒ½åˆç´„ ABI æ–‡ä»¶
- âœ… å‰ç«¯é…ç½®ï¼ˆcontracts.tsã€ç’°å¢ƒè®Šæ•¸ã€CDN é…ç½®ï¼‰
- âœ… å¾Œç«¯é…ç½®ï¼ˆcontracts.jsã€.envã€shared-config.jsonï¼‰
- âœ… å­åœ–é…ç½®ï¼ˆnetworks.jsonã€subgraph.yamlã€package.jsonï¼‰

**åŸ·è¡Œæµç¨‹**ï¼š
1. è¼‰å…¥ä¸¦é©—è­‰ä¸»é…ç½®
2. ç·¨è­¯åˆç´„ä¸¦åŒæ­¥ ABI
3. æ›´æ–°å‰ç«¯æ‰€æœ‰é…ç½®æ–‡ä»¶
4. æ›´æ–°å¾Œç«¯é…ç½®å’Œç’°å¢ƒè®Šæ•¸
5. åŒæ­¥å­åœ–é…ç½®æ–‡ä»¶
6. åŸ·è¡Œæœ€çµ‚é©—è­‰
7. ç”ŸæˆåŒæ­¥å ±å‘Šå’Œå›æ»¾è…³æœ¬

### 2. åƒ…é©—è­‰é…ç½®
æª¢æŸ¥æ‰€æœ‰é …ç›®çš„é…ç½®ä¸€è‡´æ€§ï¼Œä¸åšä»»ä½•ä¿®æ”¹ã€‚

```bash
node index.js --validate-only
```

**é©—è­‰é …ç›®**ï¼š
- åœ°å€å”¯ä¸€æ€§æª¢æŸ¥
- å‰ç«¯é…ç½®ä¸€è‡´æ€§
- å¾Œç«¯é…ç½®ä¸€è‡´æ€§
- å­åœ–é…ç½®ä¸€è‡´æ€§
- ä»£ç¢¼ä¸­çš„é…ç½®ä½¿ç”¨æª¢æŸ¥

**è¼¸å‡ºç¯„ä¾‹**ï¼š
```
é©—è­‰çµæœ: âœ… é€šé
å•é¡Œæ•¸é‡: 0
```

### 3. å›æ»¾æ“ä½œ
æ¢å¾©åˆ°ä¸Šæ¬¡åŒæ­¥å‰çš„ç‹€æ…‹ã€‚

```bash
node index.js --rollback
```

**æ³¨æ„äº‹é …**ï¼š
- åªèƒ½å›æ»¾ç•¶å‰æœƒè©±çš„ä¿®æ”¹
- é‡å•Ÿå¾Œéœ€è¦ä½¿ç”¨ç”Ÿæˆçš„å›æ»¾è…³æœ¬

### 4. ä½¿ç”¨ç”Ÿæˆçš„å›æ»¾è…³æœ¬
æ¯æ¬¡åŒæ­¥éƒ½æœƒç”Ÿæˆå°ˆç”¨å›æ»¾è…³æœ¬ã€‚

```bash
# æŸ¥çœ‹å›æ»¾è…³æœ¬
ls ../deployments/restore-*.sh

# åŸ·è¡Œå›æ»¾
bash ../deployments/restore-1754417549493.sh
```

## ğŸ¯ å¸¸è¦‹ä½¿ç”¨å ´æ™¯

### å ´æ™¯ 1ï¼šéƒ¨ç½²æ–°åˆç´„å¾ŒåŒæ­¥
```bash
# 1. éƒ¨ç½²åˆç´„ï¼ˆåœ¨åˆç´„é …ç›®ï¼‰
npx hardhat run scripts/deploy.js --network bsc

# 2. æ›´æ–° master-config.json ä¸­çš„åœ°å€

# 3. åŸ·è¡ŒåŒæ­¥
node index.js v3.6.2  # ä½¿ç”¨æ–°ç‰ˆæœ¬è™Ÿ

# 4. é©—è­‰åŒæ­¥çµæœ
node index.js --validate-only
```

### å ´æ™¯ 2ï¼šæ›´æ–°å­åœ–ç‰ˆæœ¬
```bash
# åªæ›´æ–°å­åœ–ç‰ˆæœ¬è™Ÿï¼Œä¸æ”¹è®Šåˆç´„åœ°å€
node index.js v3.6.3

# ç³»çµ±æœƒè‡ªå‹•ï¼š
# - æ›´æ–°æ‰€æœ‰å­åœ– URL
# - æ›´æ–° package.json ç‰ˆæœ¬
# - åŒæ­¥åˆ°å‰ç«¯å’Œå¾Œç«¯
```

### å ´æ™¯ 3ï¼šä¿®å¾©é…ç½®ä¸ä¸€è‡´
```bash
# 1. å…ˆé©—è­‰æ‰¾å‡ºå•é¡Œ
node index.js --validate-only

# 2. å¦‚æœæœ‰å•é¡Œï¼ŒåŸ·è¡Œå®Œæ•´åŒæ­¥
node index.js v3.6.1

# 3. ç¢ºèªå•é¡Œå·²è§£æ±º
node index.js --validate-only
```

### å ´æ™¯ 4ï¼šç·Šæ€¥å›æ»¾
```bash
# æ–¹æ³• 1ï¼šç«‹å³å›æ»¾ï¼ˆåŒä¸€æœƒè©±ï¼‰
node index.js --rollback

# æ–¹æ³• 2ï¼šä½¿ç”¨å›æ»¾è…³æœ¬ï¼ˆä»»ä½•æ™‚å€™ï¼‰
bash ../deployments/restore-1754417549493.sh
```

## ğŸ“Š è¼¸å‡ºèªªæ˜

### æˆåŠŸåŒæ­¥è¼¸å‡º
```
ğŸš€ é–‹å§‹å®Œæ•´åŒæ­¥...
ğŸ“– è¼‰å…¥é…ç½®...
âœ… å·²è¼‰å…¥ä¸»é…ç½®: 14 å€‹åˆç´„
ğŸ”„ åŒæ­¥ ABI æ–‡ä»¶...
âœ… ABI åŒæ­¥å®Œæˆ: 12/12
ğŸ¯ æ›´æ–°å‰ç«¯é…ç½®...
âœ… å‰ç«¯æ›´æ–°å®Œæˆ: 5/5
ğŸ¯ æ›´æ–°å¾Œç«¯é…ç½®...
âœ… å¾Œç«¯æ›´æ–°å®Œæˆ: 3/3
ğŸ“Š åŒæ­¥å­åœ–é…ç½®...
âœ… å­åœ–åŒæ­¥å®Œæˆ: 4/4
âœ… æœ€çµ‚é©—è­‰...
âœ… æ‰€æœ‰é©—è­‰é€šé
ğŸ‰ åŒæ­¥å®Œæˆï¼è€—æ™‚: 1.79s
```

### ç”Ÿæˆçš„æ–‡ä»¶

æ¯æ¬¡åŒæ­¥æœƒç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

1. **åŒæ­¥å ±å‘Š**
   ```
   deployments/sync-report-[timestamp].json
   ```
   åŒ…å«è©³ç´°çš„åŒæ­¥çµæœå’Œä¿®æ”¹è¨˜éŒ„ã€‚

2. **å›æ»¾è…³æœ¬**
   ```
   deployments/restore-[timestamp].sh
   ```
   å¯åŸ·è¡Œçš„ shell è…³æœ¬ï¼Œç”¨æ–¼å›æ»¾æ‰€æœ‰ä¿®æ”¹ã€‚

3. **é©—è­‰å ±å‘Š**ï¼ˆåƒ… --validate-onlyï¼‰
   ```
   deployments/validation-report-[timestamp].json
   ```
   åŒ…å«æ‰€æœ‰é©—è­‰å•é¡Œçš„è©³ç´°ä¿¡æ¯ã€‚

## âš ï¸ æ³¨æ„äº‹é …

### å¿…è¦æ¢ä»¶
1. **Node.js ç‰ˆæœ¬**ï¼šéœ€è¦ Node.js 14+
2. **ä¾è³´å®‰è£**ï¼šä¸éœ€è¦é¡å¤–å®‰è£ï¼Œä½¿ç”¨å…§å»ºæ¨¡çµ„
3. **æ¬Šé™è¦æ±‚**ï¼šéœ€è¦å°æ‰€æœ‰é …ç›®ç›®éŒ„çš„è®€å¯«æ¬Šé™

### è·¯å¾‘é…ç½®
å¦‚æœé …ç›®è·¯å¾‘æ”¹è®Šï¼Œéœ€è¦æ›´æ–°ï¼š
```javascript
// config/project-paths.js
const PROJECT_PATHS = {
  frontend: '/Users/sotadic/Documents/GitHub/DungeonDelvers',
  backend: '/Users/sotadic/Documents/dungeon-delvers-metadata-server',
  subgraph: '/Users/sotadic/Documents/GitHub/DungeonDelvers/DDgraphql/dungeon-delvers',
  contracts: '/Users/sotadic/Documents/DungeonDelversContracts'
};
```

### å¸¸è¦‹å•é¡Œ

**Q: ABI åŒæ­¥å¤±æ•—ï¼Ÿ**
```bash
# ç¢ºä¿åˆç´„å·²ç·¨è­¯
cd /Users/sotadic/Documents/DungeonDelversContracts
npx hardhat compile

# é‡æ–°åŸ·è¡ŒåŒæ­¥
cd scripts/active/sync-system
node index.js v3.6.1
```

**Q: æ‰¾ä¸åˆ°é…ç½®æ–‡ä»¶ï¼Ÿ**
```bash
# æª¢æŸ¥ master-config.json æ˜¯å¦å­˜åœ¨
ls /Users/sotadic/Documents/DungeonDelversContracts/config/master-config.json

# å¦‚æœä¸å­˜åœ¨ï¼Œå¾ v25-config.js ç”Ÿæˆ
node ../v25-config-to-master.js
```

**Q: é©—è­‰é¡¯ç¤ºåœ°å€ä¸ä¸€è‡´ï¼Ÿ**
```bash
# åŸ·è¡Œå®Œæ•´åŒæ­¥ä¾†ä¿®å¾©
node index.js v3.6.1

# å†æ¬¡é©—è­‰
node index.js --validate-only
```

## ğŸ”§ é€²éšç”¨æ³•

### è‡ªå®šç¾©åŒæ­¥
å¦‚æœåªæƒ³åŒæ­¥ç‰¹å®šéƒ¨åˆ†ï¼Œå¯ä»¥ä¿®æ”¹ `index.js`ï¼š

```javascript
// åªåŒæ­¥ ABI
const abiResults = await this.abiSyncer.syncAll();

// åªæ›´æ–°å‰ç«¯
const frontendResults = await this.frontendUpdater.updateAll(config, version);

// åªæ›´æ–°å¾Œç«¯
const backendResults = await this.backendUpdater.updateAll(config, version);

// åªåŒæ­¥å­åœ–
const subgraphResults = await this.subgraphSyncer.syncAll(config, version);
```

### æ·»åŠ æ–°åˆç´„
1. æ›´æ–° `config/project-paths.js` çš„ `ABI_SYNC_CONFIG`
2. æ›´æ–° `master-config.json` æ·»åŠ æ–°åœ°å€
3. åŸ·è¡ŒåŒæ­¥

### èª¿è©¦æ¨¡å¼
æŸ¥çœ‹è©³ç´°æ—¥èªŒï¼š
```bash
node index.js v3.6.1 --verbose
```

## ğŸ“ ç³»çµ±æ¶æ§‹

```
sync-system/
â”œâ”€â”€ index.js              # ä¸»å…¥å£
â”œâ”€â”€ USAGE_GUIDE.md        # æœ¬æ–‡æª”
â”œâ”€â”€ README.md             # æ¶æ§‹èªªæ˜
â”œâ”€â”€ core/                 # æ ¸å¿ƒæœå‹™
â”‚   â”œâ”€â”€ Logger.js         # æ—¥èªŒç³»çµ±
â”‚   â”œâ”€â”€ BackupManager.js  # å‚™ä»½ç®¡ç†
â”‚   â”œâ”€â”€ ConfigLoader.js   # é…ç½®è¼‰å…¥
â”‚   â””â”€â”€ ValidationEngine.js # é©—è­‰å¼•æ“
â”œâ”€â”€ sync/                 # åŒæ­¥å™¨
â”‚   â”œâ”€â”€ ABISyncer.js      # ABI åŒæ­¥
â”‚   â””â”€â”€ SubgraphSyncer.js # å­åœ–åŒæ­¥
â”œâ”€â”€ updaters/             # æ›´æ–°å™¨
â”‚   â”œâ”€â”€ FrontendUpdater.js # å‰ç«¯æ›´æ–°
â”‚   â””â”€â”€ BackendUpdater.js  # å¾Œç«¯æ›´æ–°
â”œâ”€â”€ utils/                # å·¥å…·
â”‚   â””â”€â”€ FileOperations.js # æ–‡ä»¶æ“ä½œ
â””â”€â”€ config/               # é…ç½®
    â””â”€â”€ project-paths.js  # è·¯å¾‘é…ç½®
```

## ğŸ†š èˆ‡èˆŠç³»çµ±å°æ¯”

| åŠŸèƒ½ | æ–°ç³»çµ± | èˆŠç³»çµ± (v25-sync-all.js) |
|------|--------|-------------------------|
| æª”æ¡ˆå¤§å° | 13K + æ¨¡çµ„ | 79K å–®æª” |
| åŸ·è¡Œé€Ÿåº¦ | ~2ç§’ | ~30ç§’ |
| æ¨¡çµ„åŒ– | âœ… 10å€‹æ¨¡çµ„ | âŒ å–®ä¸€æª”æ¡ˆ |
| å¯æ¸¬è©¦æ€§ | âœ… æ˜“æ–¼æ¸¬è©¦ | âŒ å›°é›£ |
| å¯ç¶­è­·æ€§ | âœ… æ¥µä½³ | âŒ å›°é›£ |
| å¸‚å ´åŠŸèƒ½ | âŒ å·²ç§»é™¤ | âŒ å·²æ¸…ç† |
| å›æ»¾åŠŸèƒ½ | âœ… å®Œæ•´ | âœ… åŸºæœ¬ |
| é©—è­‰åŠŸèƒ½ | âœ… æ·±åº¦ | âœ… åŸºæœ¬ |

## ğŸ’¡ æœ€ä½³å¯¦è¸

1. **æ¯æ¬¡éƒ¨ç½²å¾Œç«‹å³åŒæ­¥**
   - é¿å…é…ç½®ä¸ä¸€è‡´å°è‡´çš„éŒ¯èª¤

2. **ä½¿ç”¨èªç¾©åŒ–ç‰ˆæœ¬è™Ÿ**
   - ä¸»ç‰ˆæœ¬ï¼šé‡å¤§è®Šæ›´
   - æ¬¡ç‰ˆæœ¬ï¼šæ–°åŠŸèƒ½
   - ä¿®è¨‚ç‰ˆï¼šéŒ¯èª¤ä¿®å¾©

3. **å®šæœŸé©—è­‰é…ç½®**
   ```bash
   # æ¯é€±åŸ·è¡Œä¸€æ¬¡
   node index.js --validate-only
   ```

4. **ä¿ç•™åŒæ­¥å ±å‘Š**
   - ç”¨æ–¼è¿½è¹¤é…ç½®è®Šæ›´æ­·å²

5. **æ¸¬è©¦ç’°å¢ƒå…ˆè¡Œ**
   - åœ¨æ¸¬è©¦ç¶²åŒæ­¥ä¸¦é©—è­‰å¾Œï¼Œå†åˆ°ä¸»ç¶²

## ğŸ“ éœ€è¦å¹«åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°å•é¡Œï¼š
1. æŸ¥çœ‹åŒæ­¥å ±å‘Šäº†è§£è©³æƒ…
2. ä½¿ç”¨ `--validate-only` è¨ºæ–·å•é¡Œ
3. æŸ¥çœ‹ `deployments/` ç›®éŒ„ä¸‹çš„æ—¥èªŒ
4. å¿…è¦æ™‚ä½¿ç”¨å›æ»¾è…³æœ¬æ¢å¾©

---

*æœ€å¾Œæ›´æ–°ï¼š2025-08-06*
*ç‰ˆæœ¬ï¼šv2.0*